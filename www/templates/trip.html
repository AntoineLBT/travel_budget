{% extends "base.html" %}

{% block body %}
<!-- Page Heading -->
<div class="row mb-2">
    <div class="col-lg-6">
        <div class="pagetitle">
            <h1>{{ trip.name}}</h1>
        </div>
    </div>
    <div class="col-lg-6 d-flex justify-content-end">
        <a href="{% url 'trip-create-expense' slug=trip.slug %}" class="btn btn-outline-primary">
            <span class="icon fs-5">
                <i class="bi bi-plus"></i>
                Expense
            </span>
        </a>
    </div>
</div>
<div class="row">
    <div class="col-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Information</h5>
                <div class="row">
                    <p class="col-6"><b>Starting date</b> : {{trip.start_date}}</p>
                    <p class="col-6"><b>Ending date</b> : {{trip.start_date}}</p>
                </div>
                <p><b>Description</b> : {{trip.description}}</p>
                <div class="row">
                    <p class="col-6"><b>Total expenses</b> : {% if trip.total_expenses %}{{ trip.total_expenses }}{% else %}0.00{% endif %}€</p>
                    <p class="col-6"><b>Budget</b> : {{ trip.budget }}€</p>
                </div>
                {% if budget_completion %}
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: {{ budget_completion }}%" aria-valuenow="{{ budget_completion }}" aria-valuemin="0" aria-valuemax="100">{{ budget_completion }}%</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Expenses per category</h5>
                <canvas id="expensesPerCategory" style="max-height: 400px; display: block; box-sizing: border-box; height: 400px; width: 1040px;" width="1040" height="400"></canvas> 
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
            <h5 class="card-title">Expenses</h5>

            <!-- Table with hoverable rows -->
            <table class="table table-hover ">
              <thead>
                <tr>
                    <th scope="col" style="width: 20%">Label</th>
                    <th scope="col" style="width: 20%">Amount</th>
                    <th scope="col" style="width: 20%">Category</th>
                    <th scope="col" style="width: 20%">Date</th>
                    <th scope="col" style="width: 10%">Edit</th>
                    <th scope="col" style="width: 10%">Delete</th>
                </tr>
              </thead>
              <tbody>
                {% for expense in trip.expense_set.all %}
                <tr>
                    <td scope="row">{{expense.label}}</td>
                    <td>{{expense.amount}}</td>
                    <td>{{expense.category}}</td>
                    <td>{{expense.expense_date}}</td>
                    <td>
                        <a href="{% url 'trip-consult' slug=trip.slug %}" class="btn btn-outline-primary">
                            <span class="icon">
                                <i class="bi bi-pencil-square"></i>
                            </span>
                        </a>
                    </td>
                    <td>
                        <a href="{% url 'trip-consult' slug=trip.slug %}" class="btn btn-outline-secondary">
                            <span class="icon">
                                <i class="bi bi-trash"></i>
                            </span>
                        </a>
                    </td>
                
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <!-- End Table with hoverable rows -->

        </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
      new Chart(document.querySelector('#expensesPerCategory'), {
        type: 'doughnut',
        data: {
          labels: {{ labels|safe }},
          datasets: [{
            label: 'total',
            data: {{ data|safe }},
            backgroundColor: {{ background_color|safe }},
            hoverOffset: 4
          }]
        }
      });
    });
  </script> 
{% endblock %}